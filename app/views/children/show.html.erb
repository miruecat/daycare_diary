<div class="container">
  <% if current_user.role == "parent" && current_user.children.count > 1 %>
    <div class="d-flex justify-content-center container-normal">
      <% current_user.children.each do |child| %>
        <%= link_to child_path(child) do %>
          <div data-bs-toggle="tooltip" data-bs-placement="left" title="<%= child.first_name %>">
            <%= cl_image_tag child.profile_picture.key, class: 'avatar-large-link', crop: :fill %>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <div class="container-normal">
    <div class= "container-button-position">
      <h1><%= cl_image_tag @child.profile_picture.key, class: 'avatar-large', crop: :fill %> <%= @child.first_name %> <%= @child.last_name %></h1>
      <% if current_user.role == "employee" %>
          <div class="employeeforms">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#moment" id="momentbutton">
            Add a special moment
            </button>
          </div>
    </div>
            <!-- Modal -->

          <div class="modal fade" id="moment" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalCenterTitle">The Moment</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <%= simple_form_for @activity do |f| %>
                    <%= f.input :children_id, as: :hidden, input_html: { value: [@child.id] }   %>
                    <%= f.hidden_field :category, value: "moment" %>
                    <%= f.input :pictures, as: :file, input_html: { multiple: true }%>
                    <%= f.input :sub_category, label: false, as: :hidden, input_html: { value: "moment" } %>
                    <%= f.input :date %>
                    <%= f.input :time %>
                    <%= f.input :comment, label: "message" %>
                    <%= f.button :submit %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>


        <div class="container-normal">
          <h4>Add an activity for <%= @child.first_name %></h4>
          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#sleep" id="sleepbutton">
            Sleep
          </button>

          <!-- Modal -->
          <div class="modal fade" id="sleep" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalCenterTitle">Sleep</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <%= simple_form_for @activity do |f| %>
                    <%= f.input :children_id, as: :hidden, input_html: { value: [@child.id] }   %>
                    <%= f.hidden_field :category, value: "sleep" %>
                    <%= f.input :sub_category, as: :radio_buttons, label: false, collection: ["go to bed", "get out of bed"] %>
                    <%= f.input :date %>
                    <%= f.input :time %>
                    <%= f.input :comment %>
                    <%= f.button :submit %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#food" id="foodbutton">
            Food
          </button>

          <!-- Modal -->
          <div class="modal fade" id="food" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalCenterTitle">Food</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <%= simple_form_for @activity do |f| %>
                    <%= f.input :children_id, as: :hidden, input_html: { value: [@child.id] } %>
                    <%= f.hidden_field :category, value: "food" %>
                    <%= f.input :sub_category, as: :check_boxes, label: false, collection: ["Babyfood", "Bread", "Fruit", "Porridge", "Milk", "Did not eat"], input_html: { multiple: true } %>
                    <%= f.input :date %>
                    <%= f.input :time %>
                    <%= f.input :comment %>
                    <%= f.button :submit %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#health" id="healthbutton">
            Health
          </button>

          <!-- Modal -->
          <div class="modal fade" id="health" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalCenterTitle">Health</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <%= simple_form_for @activity do |f| %>
                    <%= f.input :children_id, as: :hidden, input_html: { value: [@child.id] }   %>
                    <%= f.hidden_field :category, value: "health" %>
                    <%= f.input :sub_category, as: :radio_buttons, label: false, collection: ["Healthy", "So-so", "Sick"] %>
                    <%= f.input :date %>
                    <%= f.input :time %>
                    <%= f.input :comment %>
                    <%= f.button :submit %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#play" id="playbutton">
            Play
          </button>

          <!-- Modal -->
          <div class="modal fade" id="play" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalCenterTitle">Play</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <%= simple_form_for @activity do |f| %>
                      <%= f.input :children_id, as: :hidden, input_html: { value: [@child.id] }   %>
                    <%= f.hidden_field :category, value: "play" %>
                    <%= f.input :sub_category, as: :radio_buttons, label: false, collection: ["Play Outside", "Play Inside"] %>
                    <%= f.input :date %>
                    <%= f.input :time %>
                    <%= f.input :comment %>
                    <%= f.button :submit %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      <%end%>

  <div class="container-large-top">
    <h2>Activity log of <%= @child.first_name %></h2>
    <div class="container-normal">
      <label for="start">Selected date:</label>
      <input type="date" id="date-activities" name="trip-start"
        value="<%= Date.today %>" min="2020-01-01" max="<%= Date.today %>">
    </div>
    <table class="table table-striped table-hover table-borderless align-middle">
      <thead class="table-dark">
        <tr>
          <th scope="col">Time</th>
          <th scope="col">Category</th>
          <th scope="col">Sub-category</th>
          <th scope="col">Comment</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <% @child.activities.each do |activity| %>
          <tr class="activity-row <%= 'd-none' unless activity.date == Date.today %>" data-date="<%= activity.date.strftime("%Y-%m-%d") %>">
            <th scope="row"><%= activity.time.strftime("%Hh%M") %></th>
            <td><%= activity.category %></td>
            <td><%= activity.sub_category %></td>
            <td><%= activity.comment %></td>
            <% if current_user.role == "employee" %>
              <td><%= link_to "Delete", activity_path(activity), method: :delete, data: { confirm: "Are you sure?" } %></td>
            <% else %>
              <td></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="carousel-top-container container-normal"">
    <div class="carouselContainer">
      <div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
        <div class="carousel-inner">
          <% @child.activity_pictures.each do |activity_picture| %>
            <% if activity_picture == @child.activity_pictures.first %>
              <div class="carousel-item active d-flex justify-content-center">
                <%= cl_image_tag activity_picture.key, class: "d-block image-carousel" %>
              </div>
            <% else %>
              <div class="carousel-item d-flex justify-content-center">
                <%= cl_image_tag activity_picture.key, class: "d-block image-carousel" %>
              </div>
            <% end %>
          <% end %>
        </div>
        <% if @child.activity_pictures.count > 1%>
          <a class="carousel-control-prev" href="#carouselExampleFade" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleFade" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        <% end %>
      </div>
    </div>
  </div>
</div>
